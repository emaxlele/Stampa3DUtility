<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Preventivo Stampa 3D ‚Äî Bambu Lab H2C</title>

<style>
:root{
  --bg:#0f172a;
  --card:#111827;
  --border:#1f2937;
  --muted:#9ca3af;
  --primary:#60a5fa;
}
body{
  margin:0;
  background:var(--bg);
  color:#fff;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
}
.wrap{max-width:900px;margin:2rem auto;padding:0 1rem}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:1.2rem}
h1{margin:0 0 1rem}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
@media(max-width:700px){.grid{grid-template-columns:1fr}}
label{display:block;margin-top:.6rem}
input,select{
  width:100%;
  padding:.55rem;
  margin-top:.25rem;
  background:#0b1220;
  color:#fff;
  border:1px solid var(--border);
  border-radius:8px;
}
.btn{
  padding:.6rem .9rem;
  border-radius:10px;
  border:1px solid var(--border);
  background:#0b1220;
  color:#fff;
  cursor:pointer;
}
.btn.primary{background:var(--primary);color:#001c32;border:none;font-weight:700}
.actions{display:flex;gap:.7rem;flex-wrap:wrap;margin-top:1rem}
.total{font-size:1.3rem;font-weight:800;margin-top:1rem}
.break{
  background:#0b1220;
  border:1px solid var(--border);
  border-radius:10px;
  padding:.8rem;
  margin-top:.8rem;
  white-space:pre-wrap;
}
.footer{font-size:.85rem;color:#9ca3af;margin-top:1rem}

@media print{
  .actions,.footer{display:none}
  body{background:#fff;color:#000}
  .card,.break{border-color:#ccc;background:#fff}
}
</style>
</head>

<body>
<div class="wrap">
<h1>Preventivo Stampa 3D ‚Äî Bambu Lab H2C</h1>

<div class="card">

<div>
	<label>Tipo utilizzo</label>
	<select id="mode">
	  <option value="hobby">Uso personale / hobby</option>
	  <option value="pro">Vendita / commerciale</option>
	</select>
</div>

<div class="grid">
  <div>
    <label>Grammi materiale</label>
    <input id="grams" type="number" min="0" value="50">
  </div>
  <div>
    <label>Prezzo bobina ‚Ç¨/kg</label>
    <input id="ppg" type="number" value="25">
  </div>
</div>

<div class="grid">
  <div>
    <label>Ore</label>
    <input id="hours" type="number" min="0" value="1">
  </div>
  <div>
    <label>Minuti</label>
    <input id="minutes" type="number" min="0" max="59" value="0">
  </div>
</div>

<div class="actions">
  <button class="btn primary" id="calc">Calcola</button>
  <button class="btn" onclick="window.print()">Stampa / PDF</button>
</div>

<div class="total" id="total">Totale: ‚Äî</div>

</div>

<div class="actions">
  <button class="btn" id="rulesBtn">üìú Regolamento</button>
</div>

<div id="rulesBox" class="break" style="display:none">
<strong>REGOLAMENTO DI UTILIZZO ‚Äì SERVIZIO DI STAMPA 3D</strong>

‚Ä¢ Il prezzo √® calcolato automaticamente in base a materiale, tempo e avviamento.
‚Ä¢ In caso di errori nel file fornito, i costi restano validi al 100%.
‚Ä¢ In caso di problemi tecnici del servizio, la stampa viene ripetuta gratis.

‚ö†Ô∏è <strong>ATTENZIONE:</strong> Se la stampa fallisce per difetti del file o impostazioni errate richieste, il servizio viene addebitato interamente (risorse gi√† impiegate).

‚Ä¢ Il calcolo si riferisce a file forniti dall'utente. Progettazione CAD o ottimizzazioni sono valutate separatamente.

<em>L‚Äôutilizzo del tool implica l‚Äôaccettazione del presente regolamento.</em>
</div>

</div>

<script>
const el = id => document.getElementById(id);
const euro = v => "‚Ç¨ " + v.toFixed(2);

function updateRate(){
  // Tariffa base 1 ‚Ç¨/h + 0,5 ‚Ç¨/h extra (mostriamo solo base)
  //el("rate").value = el("mode").value === "pro" ? 1 : 1;
  el("mode").value === "pro" ? 1 : 1;
}

function calc(){
	const isHobby = el("mode").value === "hobby";

	const grams = +el("grams").value;
	const ppg = +el("ppg").value / 1000;

	const hoursInput = +el("hours").value;
	const minutesInput = +el("minutes").value;

	// ore totali come frazione decimale
	const hours = hoursInput + minutesInput / 60;

	// Costi materiali
	const material = grams * ppg;

	// Usura macchina
	const princeMachine = isHobby ? 0.30 : 0.75
	let machine;
	if (hours <= 1) {
	  machine = princeMachine; // costo fisso per la prima ora
	} else {
	  machine = princeMachine + (hours - 1) * (princeMachine + 0); // aggiungi 0.30 per ogni ora extra/frazione
	}

	// Tariffa lavoro
	const princeLabore = isHobby ? 0.35 : 0.60
	let labor;
	if (hours <= 1) {
	 // labor = 1; // costo fisso per la prima ora
		labor = Math.max((hours - 1) * (princeLabore + 0), 0.50); //se il risultato √® minore di 50, viene restituito 50; altrimenti resta il valore calcolato.
	} else if(hours <= 2) {
	  labor = 0.65 + (hours - 1) * (princeLabore + 0); // 0,35 euro per ogni ora extra/frazione
	} else {
	  labor = 0.65 + (hours - 1) * (princeLabore + 0); // 0,35 euro per ogni ora extra/frazione
	}

	//console.log("Materiale:", material.toFixed(2), "‚Ç¨");
	//console.log("Macchina:", machine.toFixed(2), "‚Ç¨");
	//console.log("Lavoro:", labor.toFixed(2), "‚Ç¨");


  // Base totale
  const baseTotal = material + machine + labor;
	//console.log("Totale:", baseTotal.toFixed(2), "‚Ç¨");

  // Percentuale margine variabile
	let pct = 0.35; // default
	if(baseTotal <= 3) pct = 0.05;
	else if(baseTotal <= 5) pct = 0.10;
	else if(baseTotal <= 7.5) pct = 0.10;
	else if(baseTotal <= 10) pct = 0.10;
	else if(baseTotal <= 15) pct = 0.10;
	else if(baseTotal <= 20) pct = 0.10;
	else if(baseTotal <= 25) pct = 0.07;
	else pct = 0.06; // >25‚Ç¨


  // Totale finale
  let total = baseTotal * (1 + pct);

	const margin = total - (material + machine)

  el("total").textContent = "Totale: " + euro(total);
  
  	console.debug("Totale:", total.toFixed(2), "‚Ç¨");

    console.debug(`
	Materiale: ${euro(material)}
	Usura macchina: ${euro(machine)}
	Tempo lavoro: ${euro(labor)}
	Totale base: ${euro(baseTotal)}
	Percentuale margine applicata: ${Math.round(pct*100)}%
	Margine guadagno: ${euro(margin)}`);
	  	
	console.debug("------------------------------------------");

}

el("mode").addEventListener("change", updateRate);
el("calc").addEventListener("click", calc);

updateRate();

const rulesBtn = el("rulesBtn");
const rulesBox = el("rulesBox");
rulesBtn.addEventListener("click", () => {
  const open = rulesBox.style.display === "block";
  rulesBox.style.display = open ? "none" : "block";
});
</script>

</body>
</html>
